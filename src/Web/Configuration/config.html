<!DOCTYPE html>
<html>
<head>
  <script>
  // --- HARD SHIM: neutralize behavior:null bugs in Jellyfin bundles ---
  (function () {
    function sanitizeOptions(arg) {
      if (arg && typeof arg === 'object') {
        const o = Object.assign({}, arg);
        if ('behavior' in o && (o.behavior == null || o.behavior === 'null')) {
          o.behavior = 'auto';
        }
        return o;
      }
      return arg;
    }
    function wrap(host, method) {
      if (!host || !host[method]) return;
      const orig = host[method].bind(host);
      try {
        host[method] = function (...args) {
          if (args[0] && typeof args[0] === 'object') {
            args[0] = sanitizeOptions(args[0]);
          }
          try {
            return orig(...args);
          } catch (e) {
            // Fallback auf Koordinaten-Form
            if (args[0] && typeof args[0] === 'object') {
              const left = Number(args[0].left || 0);
              const top  = Number(args[0].top  || 0);
              return orig(left, top);
            }
            // Letzter Notnagel: Fehler schlucken
            return;
          }
        };
      } catch (_) {}
    }
    // Patch alle relevanten Prototypen/Objekte
    try {
      wrap(window, 'scrollTo');
      wrap(Window.prototype, 'scrollTo');
    } catch (_) {}
    try {
      wrap(Document.prototype, 'scrollTo');
    } catch (_) {}
    try {
      wrap(Element.prototype, 'scrollTo');
      // scrollIntoView hat auch options.behavior
      const sIV = Element.prototype.scrollIntoView;
      if (sIV) {
        Element.prototype.scrollIntoView = function (arg) {
          if (arg && typeof arg === 'object') arg = sanitizeOptions(arg);
          try { return sIV.call(this, arg); } catch (e) { return; }
        };
      }
    } catch (_) {}

    // Falls doch irgendwo ein Promise platzt: nicht alles abbrechen lassen
    window.addEventListener('unhandledrejection', (ev) => {
      const msg = String(ev.reason || '');
      if (msg.includes("ScrollOptions") || msg.includes("scrollTo")) {
        ev.preventDefault();
        // console.warn('[Shim] swallowed scrollTo rejection:', msg);
      }
    });
  })();
  </script>

  <meta charset="utf-8" />
  <title>Folder Collections – Konfiguration</title>
  <style>
    .sectionTitle{font-weight:600;margin:16px 0 8px}
    .inputContainer{margin:8px 0}
    .inputLabel{display:block;margin-bottom:4px}
    textarea,input,select,button{width:100%;max-width:800px}
    .buttonRow{display:flex;gap:8px;flex-wrap:wrap;margin-top:12px}
    .buttonRow button{width:auto}
  </style>
</head>
<body>
  <div id="FolderCollectionsConfigurationPage"
       data-role="page"
       class="page type-interior pluginConfigurationPage"
       data-title="Folder Collections">

    <div data-role="content">
      <div class="content-primary">
        <form id="fcForm">

          <div class="sectionTitle">Quellordner</div>

          <div class="inputContainer">
            <label class="inputLabel" for="fcIncludeFolders">Ordner scannen (ein Pfad pro Zeile)</label>
            <textarea id="fcIncludeFolders" rows="6" placeholder="/media/filme
/media/serien"></textarea>
          </div>

          <div class="inputContainer">
            <label class="inputLabel" for="fcExcludeFolders">Blacklist (ein Pfad/Pattern pro Zeile)</label>
            <textarea id="fcExcludeFolders" rows="5" placeholder="/media/filme/Extras
**/Sample
**/*.srt"></textarea>
          </div>

          <div class="sectionTitle">Sammlungsname</div>
          <div class="inputContainer">
            <label class="inputLabel" for="fcNamePrefix">Präfix</label>
            <input id="fcNamePrefix" type="text" placeholder="Collection - ">
          </div>

          <div class="inputContainer">
            <label class="inputLabel" for="fcNameSuffix">Suffix</label>
            <input id="fcNameSuffix" type="text" placeholder=" (Auto)">
          </div>

          <div class="inputContainer">
            <label class="inputLabel" for="fcMinItemsPerFolder">Mindest-Items pro Ordner</label>
            <input id="fcMinItemsPerFolder" type="number" min="0" step="1" placeholder="2">
          </div>

          <div class="sectionTitle">Automatisierung</div>
          <div class="inputContainer">
            <label>
              <input id="fcEnableDailyScan" type="checkbox">
              Täglichen Scan aktivieren
            </label>
          </div>
          <div class="inputContainer">
            <label class="inputLabel" for="fcDailyTime">Uhrzeit für täglichen Scan</label>
            <input id="fcDailyTime" type="time">
            <div class="fieldDescription">Format HH:MM (Serverzeit).</div>
          </div>

          <div class="buttonRow">
            <button id="fcScanNow" type="button">Jetzt scannen</button>
            <button id="fcReload"  type="button">Neu laden</button>
            <button id="fcSave"    type="submit">Speichern</button>
          </div>

        </form>
      </div>
    </div>
  </div>

  <script src="FolderCollections.Web.Configuration.config.js"></script>
</body>
</html>
